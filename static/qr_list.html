<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QR Print List</title>
  <style>
    :root {
      --bg: #0f1411;
      --panel: #161c19;
      --text: #e9f3ed;
      --muted: #9fb0a6;
      --border: #2b3a32;
      --accent: #79d498;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Space Grotesk", "Segoe UI", sans-serif;
      color: var(--text);
      background: var(--bg);
      padding: 24px;
    }
    .wrap { max-width: 960px; margin: 0 auto; }
    h1 { margin: 0 0 8px; }
    p { color: var(--muted); margin: 0 0 16px; }
    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }
    a { color: var(--accent); text-decoration: none; }
    .home-link { margin-bottom: 12px; }
    .home-link a {
      display: inline-block;
      padding: 8px 12px;
      border-radius: 10px;
      background: var(--panel);
      color: var(--accent);
      text-decoration: none;
      font-weight: 600;
      border: 1px solid var(--border);
    }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <div class="home-link">
    <a href="/home">‚Üê Home</a>
  </div>
  <div class="wrap">
    <h1>QR Print List <span style="font-size:12px;opacity:0.6;">v1.0.1</span></h1>
    <p>Print one QR per facility.</p>
    <div id="list"></div>
  </div>

  <script>
    // Load facilities and associated QR values.
    async function load() {
      const [facRes, locRes] = await Promise.all([
        fetch("/facilities"),
        fetch("/locations")
      ]);
      const facs = await facRes.json();
      const locs = await locRes.json();
      const locByFacility = {};
      locs.forEach((l) => { locByFacility[l.facility_id] = l; });

      const list = document.getElementById("list");
      list.innerHTML = "";
      facs.forEach((f) => {
        const loc = locByFacility[f.id];
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <strong>${f.name}</strong><br/>
          QR: ${loc ? loc.qr_value : "Missing"}<br/>
          <a href="/qr/${encodeURIComponent(f.id)}" target="_blank">Print QR</a>
        `;
        list.appendChild(div);
      });
    }
    load();
  </script>
</body>
</html>
